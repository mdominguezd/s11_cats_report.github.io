<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martín Domínguez Durán">

<title>S11-CATS Report - Cataloguing and visualizing big Geodata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">S11-CATS Report</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Report</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About the author</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive summary</a></li>
  <li><a href="#list-of-abreviations" id="toc-list-of-abreviations" class="nav-link" data-scroll-target="#list-of-abreviations">List of abreviations</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#internship-organization-background" id="toc-internship-organization-background" class="nav-link" data-scroll-target="#internship-organization-background">Internship organization background</a></li>
  <li><a href="#context-and-justification-of-research" id="toc-context-and-justification-of-research" class="nav-link" data-scroll-target="#context-and-justification-of-research">Context and justification of research</a>
  <ul class="collapse">
  <li><a href="#significance-of-the-topic-and-previous-research" id="toc-significance-of-the-topic-and-previous-research" class="nav-link" data-scroll-target="#significance-of-the-topic-and-previous-research">Significance of the topic and previous research</a></li>
  <li><a href="#added-value-of-this-research" id="toc-added-value-of-this-research" class="nav-link" data-scroll-target="#added-value-of-this-research">Added value of this research</a></li>
  </ul></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research questions</a></li>
  </ul></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#sec-baseline" id="toc-sec-baseline" class="nav-link" data-scroll-target="#sec-baseline">Baseline scenario</a></li>
  <li><a href="#data-and-service-integration" id="toc-data-and-service-integration" class="nav-link" data-scroll-target="#data-and-service-integration">Data and service integration</a>
  <ul class="collapse">
  <li><a href="#dataset-selection" id="toc-dataset-selection" class="nav-link" data-scroll-target="#dataset-selection">Dataset selection</a></li>
  <li><a href="#proposed-catalog-structure" id="toc-proposed-catalog-structure" class="nav-link" data-scroll-target="#proposed-catalog-structure">Proposed Catalog structure</a></li>
  <li><a href="#s11-cats-repository" id="toc-s11-cats-repository" class="nav-link" data-scroll-target="#s11-cats-repository">S11-cats repository</a></li>
  <li><a href="#sec-eoapi" id="toc-sec-eoapi" class="nav-link" data-scroll-target="#sec-eoapi">eoAPI + other services</a></li>
  <li><a href="#cicd-pipeline" id="toc-cicd-pipeline" class="nav-link" data-scroll-target="#cicd-pipeline">CI/CD pipeline</a></li>
  <li><a href="#comparison-with-baseline-scenario" id="toc-comparison-with-baseline-scenario" class="nav-link" data-scroll-target="#comparison-with-baseline-scenario">Comparison with baseline scenario</a></li>
  </ul></li>
  <li><a href="#multi-format-data-visualization" id="toc-multi-format-data-visualization" class="nav-link" data-scroll-target="#multi-format-data-visualization">Multi-format data visualization</a>
  <ul class="collapse">
  <li><a href="#speed-up" id="toc-speed-up" class="nav-link" data-scroll-target="#speed-up">Speed up</a></li>
  <li><a href="#zoom-level-influence" id="toc-zoom-level-influence" class="nav-link" data-scroll-target="#zoom-level-influence">Zoom level influence</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results-discussion" id="toc-results-discussion" class="nav-link" data-scroll-target="#results-discussion">Results &amp; Discussion</a>
  <ul class="collapse">
  <li><a href="#baseline-scenario" id="toc-baseline-scenario" class="nav-link" data-scroll-target="#baseline-scenario">Baseline scenario</a>
  <ul class="collapse">
  <li><a href="#current-workflow" id="toc-current-workflow" class="nav-link" data-scroll-target="#current-workflow">Current workflow</a></li>
  <li><a href="#thematic-content-analysis" id="toc-thematic-content-analysis" class="nav-link" data-scroll-target="#thematic-content-analysis">Thematic Content Analysis</a></li>
  </ul></li>
  <li><a href="#service-integration" id="toc-service-integration" class="nav-link" data-scroll-target="#service-integration">Service integration</a>
  <ul class="collapse">
  <li><a href="#effective-integration" id="toc-effective-integration" class="nav-link" data-scroll-target="#effective-integration">Effective integration</a></li>
  <li><a href="#workflow-improvement" id="toc-workflow-improvement" class="nav-link" data-scroll-target="#workflow-improvement">Workflow improvement</a></li>
  </ul></li>
  <li><a href="#performance-of-multi-format-data-visualization" id="toc-performance-of-multi-format-data-visualization" class="nav-link" data-scroll-target="#performance-of-multi-format-data-visualization">Performance of multi-format data visualization</a>
  <ul class="collapse">
  <li><a href="#raster-formats" id="toc-raster-formats" class="nav-link" data-scroll-target="#raster-formats">Raster formats</a></li>
  <li><a href="#effects-of-zoom-level" id="toc-effects-of-zoom-level" class="nav-link" data-scroll-target="#effects-of-zoom-level">Effects of zoom level</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#sec-baseline-q" id="toc-sec-baseline-q" class="nav-link" data-scroll-target="#sec-baseline-q">Baseline scenario questionnaire</a>
  <ul class="collapse">
  <li><a href="#related-to-data-discovery" id="toc-related-to-data-discovery" class="nav-link" data-scroll-target="#related-to-data-discovery">Related to data discovery</a></li>
  <li><a href="#related-to-data-visualization" id="toc-related-to-data-visualization" class="nav-link" data-scroll-target="#related-to-data-visualization">Related to data visualization</a></li>
  </ul></li>
  <li><a href="#sec-gpt-prompt" id="toc-sec-gpt-prompt" class="nav-link" data-scroll-target="#sec-gpt-prompt">Thematic Content Analysis prompt</a></li>
  <li><a href="#sec-request-code" id="toc-sec-request-code" class="nav-link" data-scroll-target="#sec-request-code">Code to evaluate request times</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="FinalReport.pdf"><i class="bi bi-file-pdf"></i>PDF (titlepage)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cataloguing and visualizing big Geodata</h1>
<p class="subtitle lead">Final report</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Martín Domínguez Durán </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Wageningen University &amp; Research
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1 unnumbered">
<h1 class="unnumbered">Executive summary</h1>

</section>
<section id="list-of-abreviations" class="level1 unnumbered">
<h1 class="unnumbered">List of abreviations</h1>
<table class="table-striped table-hover table">
<caption>Abbreviation list</caption>
<colgroup>
<col style="width: 55%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Abreviations</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EUDR</td>
<td>European Union Deforestation Regulation</td>
</tr>
<tr class="even">
<td>STAC</td>
<td>Spatio-Temporal Asset Catalog</td>
</tr>
<tr class="odd">
<td>COG</td>
<td>Cloud-Optimized GeoTiff</td>
</tr>
<tr class="even">
<td>OGC</td>
<td>Open Geospatial Consortium</td>
</tr>
<tr class="odd">
<td>SDI</td>
<td>Spatial Data Infrastructure</td>
</tr>
<tr class="even">
<td>S11</td>
<td>Satelligence</td>
</tr>
<tr class="odd">
<td>K8</td>
<td>Kubernetes</td>
</tr>
<tr class="even">
<td>DPROF</td>
<td>Distributed Processing Framework</td>
</tr>
<tr class="odd">
<td>JSON</td>
<td>JavaScript Object Notation</td>
</tr>
<tr class="even">
<td>API</td>
<td>Application Programming Interfaces</td>
</tr>
<tr class="odd">
<td>HTTP</td>
<td>HyperText Transfer Protocol</td>
</tr>
<tr class="even">
<td>SQL</td>
<td>Standard Query Language</td>
</tr>
<tr class="odd">
<td>FBL</td>
<td>Forest Baseline</td>
</tr>
<tr class="even">
<td>DEM</td>
<td>Digital Elevation Map</td>
</tr>
<tr class="odd">
<td>TCA</td>
<td>Thematic Content analysis</td>
</tr>
<tr class="even">
<td>VRT</td>
<td>Vitual Raster</td>
</tr>
</tbody>
</table>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="internship-organization-background" class="level2">
<h2 class="anchored" data-anchor-id="internship-organization-background">Internship organization background</h2>
<p>Satelligence (S11) is a company founded in 2016 that specializes in providing satellite-based actionable information by monitoring environmental risks in commodity supply chains and financial investment planning <span class="citation" data-cites="satelligence_home_nodate">(<a href="#ref-satelligence_home_nodate" role="doc-biblioref">Satelligence, n.d.</a>)</span>. More specifically, the company processes terabytes of satellite imagery to detect environmental risks and presents this information to their clients in a web application to assist them in the migration towards more sustainable sourcing models and the compliance with deforestation-free commodities regulations, such as the European Union Deforestation Regulation (EUDR) <span class="citation" data-cites="satelligence_internship_2023">(<a href="#ref-satelligence_internship_2023" role="doc-biblioref">Satelligence, 2023</a>)</span>. S11’s main focus is continuous deforestation monitoring (CDM) in the tropics using freely accessible satellite imagery. This is a data-intensive task that is achieved by leveraging the benefits of cloud computing, specifically Google Cloud Platform.</p>
</section>
<section id="context-and-justification-of-research" class="level2">
<h2 class="anchored" data-anchor-id="context-and-justification-of-research">Context and justification of research</h2>
<p>Satelligence strongly relies on cloud computing for their services. They process extensive volumes of satellite imagery amounting to terabytes using DPROF, a distributed processing framework created within the company to efficiently process multidimensional spatial datasets. While this processing workflow currently runs smoothly, the company’s data and operations teams face challenges when going deeper into the analysis and accessing intermediate results due to the big nature of this data <span class="citation" data-cites="satelligence_internship_2023">(<a href="#ref-satelligence_internship_2023" role="doc-biblioref">Satelligence, 2023</a>)</span>. Scholars have defined big data as datasets characterized by their high Volume, Velocity, and Variety, which makes it paramount to use advanced processing and analytics techniques to derive relevant insights <span class="citation" data-cites="giri_big_2014">(<a href="#ref-giri_big_2014" role="doc-biblioref">Giri and Lone, 2014</a>)</span>. In the specific case of Satelligence, their datasets can be categorized as big data due to their: High volume (Terabytes of satellite images processed every day), high velocity (Near – real time processing of these images) and high variety (Imagery coming from different sensors and regions). All these datasets are a specific case of big data: Big Geodata.</p>
<section id="significance-of-the-topic-and-previous-research" class="level3">
<h3 class="anchored" data-anchor-id="significance-of-the-topic-and-previous-research">Significance of the topic and previous research</h3>
<p>In the past decades there has been a rapid increase in the amount and size of geo-spatial information that can be accessed. Nowadays, more than 150 satellites orbit the earth collecting thousands of images every single day <span class="citation" data-cites="zhao_scalable_2021">(<a href="#ref-zhao_scalable_2021" role="doc-biblioref">Zhao et al., 2021</a>)</span>. This has made data handling and the introduction of spatial data infrastructures (SDIs) paramount when working with such big datasets.</p>
<p>Traditionally, SDIs have served to ease the accessibility, integration and analysis of spatial data <span class="citation" data-cites="rajabifard_spatial_2001">(<a href="#ref-rajabifard_spatial_2001" role="doc-biblioref">Rajabifard and Williamson, 2001</a>)</span>. However, in practice SDIs have been built upon technologies that focus on data preservation rather than accessibility <span class="citation" data-cites="durbha_advances_2023">(<a href="#ref-durbha_advances_2023" role="doc-biblioref">Durbha et al., 2023</a>)</span>. Due to this, an important shift is underway towards more cloud-based SDIs <span class="citation" data-cites="tripathi_cloud_2020">(<a href="#ref-tripathi_cloud_2020" role="doc-biblioref">Tripathi et al., 2020</a>)</span>. These platforms need the emergence of new technologies that prioritize seamless access to cloud-stored data, efficient discovery services that ensure the easy location of extensive spatial data, and data visualization interfaces where multiple datasets can be depicted.</p>
<section id="cloud-based-data-storage" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="cloud-based-data-storage">Cloud-based data storage</h4>
<p>Spatial data, just like any other type of data, can be cataloged into structured and unstructured data. Structured datasets are often organized and follow a specific structure (i.e.&nbsp;A traditional table with rows (objects) and columns (features)). On the other hand, unstructured data does not have a predefined structure (e.g.&nbsp;Satellite imagery and Time series data) <span class="citation" data-cites="mishra_structured_2017">(<a href="#ref-mishra_structured_2017" role="doc-biblioref">Mishra and Misra, 2017</a>)</span>. The management of structured data has witnessed substantial advancements, making it straightforward to handle it systematically using, for instance, relational databases (i.e.&nbsp;With the help of Structured Query Language (SQL)) <span class="citation" data-cites="kaufmann_database_2023">(<a href="#ref-kaufmann_database_2023" role="doc-biblioref">Kaufmann and Meier, 2023</a>)</span>. In contrast, due to the additional challenges associated with the handling of unstructured data, the developments in this area have taken a longer time to appear.</p>
<p>The emergence of cloud-based archives has been one of the main advancements for unstructured data management during the last decades. In the specific case of geo-spatial data, it has allowed to store terabytes of unstructured data (i.e.&nbsp;Satellite imagery) on the cloud and access it through the network. However, the necessity transmitting data across networks to access it makes it essential to develop new data formats suited for such purposes <span class="citation" data-cites="durbha_advances_2023">(<a href="#ref-durbha_advances_2023" role="doc-biblioref">Durbha et al., 2023</a>)</span>.</p>
<p>At S11, the storage of large geo-spatial data is already managed using Google Storage Buckets, and they are currently in the process of incorporating the conversion to cloud-optimized data formats like Cloud Optimized GeoTIFFs (COGs) and Zarrs in their processing framework (DPROF) to improve efficiency and accessibility.</p>
<p><strong>Cloud-optimized data formats</strong></p>
<p><em>COG</em></p>
<p>Cloud-Optimized GeoTIFFs (<a href="https://www.cogeo.org/">COGs</a>) are an example of data formats that have been created to ease the access of data stored in the cloud. They improve the readability by including the metadata in the initial bytes of the file stored, storing different image overviews for different scales and tiling the images in smaller blocks. These characteristics make COG files heavier than traditional image formats. However, they also greatly enhance accessibility by enabling the selective transfer of only the necessary tiles using HTTP GET requests <span class="citation" data-cites="desruisseaux_ogc_2021">(<a href="#ref-desruisseaux_ogc_2021" role="doc-biblioref">Desruisseaux et al., 2021</a>)</span>. Additionally, this data format has been adopted as an Open Geospatial Consortium (OGC) standard. These standards are a set of guidelines and specifications created to facilitate data interoperability <span class="citation" data-cites="ogc_ogc_2023">(<a href="#ref-ogc_ogc_2023" role="doc-biblioref">OGC, 2023</a>)</span>.</p>
<p><em>Zarr</em></p>
<p>Another cloud native data format that has gained popularity recently is <a href="https://zarr.readthedocs.io/en/stable/">Zarr</a>. This data format and python library focuses on the cloud-optimization of n-dimensional arrays. Zarr, differently than COGs store the metadata separately from the data chunks using lightweight external JSON files <span class="citation" data-cites="durbha_advances_2023">(<a href="#ref-durbha_advances_2023" role="doc-biblioref">Durbha et al., 2023</a>)</span>. Additionally, this data format stores the N-dimensional arrays in smaller chunks that can be accessed more easily. While the storage of Zarr files in chunks facilitates more efficient data access, the absence of overviews hinders the visualization of this data in a web map service <span class="citation" data-cites="desruisseaux_ogc_2021">(<a href="#ref-desruisseaux_ogc_2021" role="doc-biblioref">Desruisseaux et al., 2021</a>)</span>. Due to the increasing use of Zarr for geo-spatial purposes, the OGC endorsed Zarr V2 as a community standard. Nevertheless, efforts are still being made to have a geo-spatial Zarr standard adopted by OGC <span class="citation" data-cites="chester_ogc_2024">(<a href="#ref-chester_ogc_2024" role="doc-biblioref">Chester, 2024</a>)</span>.</p>
</section>
<section id="data-discovery-services" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="data-discovery-services">Data discovery services</h4>
<p>A discovery service that recently has become widely used for the exploration of big geo-data is Spatio-Temporal Asset Catalog (STAC). Through the standardization of spatio-temporal metadata, STAC simplifies the management and discovery of big geo-data <span class="citation" data-cites="brodeur_geographic_2019">(<a href="#ref-brodeur_geographic_2019" role="doc-biblioref">Brodeur et al., 2019</a>)</span>. This service works by organizing the data into catalogs, collections, items, and assets stored as lightweight JSON formats (See <a href="#tbl-stac-comps" class="quarto-xref">Table&nbsp;1</a>) <span class="citation" data-cites="durbha_advances_2023">(<a href="#ref-durbha_advances_2023" role="doc-biblioref">Durbha et al., 2023</a>)</span>.</p>
<p>Moreover, there are two types of STAC catalogs: static and dynamic. Static catalogs are pre-generated and stored as static JSON files on a cloud storage. Static catalogs follow sensible hierarchical relationships between STAC components and this feature makes it easy to be browsed and/or crawled by. Nevertheless, these catalogs cannot be queried. On the other hand, dynamic catalogs are generated as applications that respond to queries dynamically. Notably, dynamic catalogs will show different views of the same catalog depending on queries which usually focus on the spatio-temporal aspect of the data <span class="citation" data-cites="noauthor_stac-specbest-practicesmd_nodate">(<a href="#ref-noauthor_stac-specbest-practicesmd_nodate" role="doc-biblioref">RadiantEarth, 2024</a>)</span>.</p>
<div id="tbl-stac-comps" class="striped hover quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-stac-comps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: STAC components
</figcaption>
<div aria-describedby="tbl-stac-comps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover table">
<colgroup>
<col style="width: 55%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th><strong>STAC components</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Assets</em></td>
<td>An asset can be any type of data with a spatial and a temporal component.</td>
</tr>
<tr class="even">
<td><em>Items</em></td>
<td>An item is a GeoJSON feature with some specifications like: Time, Link to the asset (e.g.&nbsp;Google bucket)</td>
</tr>
<tr class="odd">
<td><em>Collections</em></td>
<td>Defines a set of common fields to describe a group of Items that share properties and metadata</td>
</tr>
<tr class="even">
<td><em>Catalogs</em></td>
<td>Contains a list of STAC collections, items or can also contain child catalogs.</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>In the specific case of dynamic catalogs, the concept of <a href="https://github.com/radiantearth/stac-api-spec/">STAC API</a> is widely used. In general, an API is a set of rules and protocols that enables different software applications to communicate with each other <span class="citation" data-cites="clark_api_2020">(<a href="#ref-clark_api_2020" role="doc-biblioref">Clark, 2020</a>)</span>. In the case of the STAC API, it provides endpoints for searching and retrieving geo-spatial data based on criteria such as location and time, delivering results in a standardized format that ensures compatibility with various tools and services in the geo-spatial community. Moreover, even though STAC API is not an OGC standard or an OGC community standard, the basic requests performed in a STAC API adheres to the <a href="https://ogcapi.ogc.org/features/">OGC API-Features</a> standards for querying by bounding box and time range, returning GeoJSON-formatted results that conform to both STAC and OGC specifications. Ultimately, compared to <a href="https://ogcapi.ogc.org/features/">OGC API-Features</a>, <a href="https://github.com/radiantearth/stac-api-spec/">STAC API</a> enhances functionality by providing additional features that users needed (e.g.&nbsp;cross-collection search, versioning) <span class="citation" data-cites="holmes_spatiotemporal_2021">(<a href="#ref-holmes_spatiotemporal_2021" role="doc-biblioref">Holmes, 2021</a>)</span>.</p>
<p>To facilitate easy browsing of both static and dynamic STAC catalogs, <a href="https://github.com/radiantearth/stac-browser">STAC Browser</a> was created. This web-application provides a user-friendly interface to search, visualize, and, in the case of dynamic catalogs, query assets within a catalog.</p>
</section>
<section id="visualization-interfaces" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="visualization-interfaces">Visualization interfaces</h4>
<p>The visualization of spatial data brings with it a series of challenges due to its big nature. Dynamic tiling libraries such as <a href="https://developmentseed.org/titiler/">TiTiler</a> have tackled multiple of these challenges by creating APIs that dynamically generate PNG/JPEG image tiles when requested without reading the entire source file into memory <span class="citation" data-cites="noauthor_titiler_nodate">(<a href="#ref-noauthor_titiler_nodate" role="doc-biblioref"><em><span>TiTiler</span></em>, n.d.</a>)</span>. This feature optimizes rendering of images since PNG and JPEG image file formats are more easily transferred through the web.</p>
<p>TiTiler supports various data structures including STAC (SpatioTemporal Asset Catalog), Cloud Optimized GeoTIFFs (COGs), and is currently working on adding support for Zarrs. For the first two, the <a href="https://github.com/stac-utils/titiler-pgstac">TiTiler PgSTAC</a> specialized extension integrates with PostgreSQL to enhance STAC catalog querying capabilities. For the case of Zarrs, the <a href="https://github.com/developmentseed/titiler-xarray">TiTiler-Xarray</a> extension is being developed to facilitate the visualization of multidimensional data arrays.</p>
</section>
<section id="cloud-services" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="cloud-services">Cloud services</h4>
<p>Cloud services facilitate the seamless integration of multiple services, such as the data visualization interfaces and data discovery services described before. Nevertheless, there is not a one fit all cloud solution that will always work efficiently. For instance, different cloud providers like Amazon Web Services or Google Cloud Platform (GCP) offer different tools that may offer different performances based on parameters like latency or scalability. Choosing the correct cloud service or set of services for the integration of data discovery and data visualization tools remains paramount.</p>
</section>
</section>
<section id="added-value-of-this-research" class="level3">
<h3 class="anchored" data-anchor-id="added-value-of-this-research">Added value of this research</h3>
<p>This research aims to identify efficient solutions for the company’s current challenges in discovering and visualizing large geo-spatial datasets by integrating cloud-optimized data formats, cloud services, STAC specifications, and dynamic tiling services. The outcomes of this research will: offer valuable insights into the existing data discovery challenges within the company, propose a methodology for integrating discovery and visualization services, and evaluate the effectiveness of dynamic tiling for various cloud-optimized data formats.</p>
</section>
</section>
<section id="research-questions" class="level2">
<h2 class="anchored" data-anchor-id="research-questions">Research questions</h2>
<ul>
<li>What are the current challenges, practices, and user experiences related to data discovery and data visualization in the company?</li>
<li>How can cloud-optimized data formats, cloud services and SpatioTemporal Asset Catalog (STAC) specifications be integrated to enhance the process and experiences of discovering big spatial data within the company?</li>
<li>To what extent do dynamic tiling services perform in visualizing different cloud-optimized data formats?</li>
</ul>
</section>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<p>To answer the research questions presented a series of tasks were undertaken. These tasks are presented in the following subsections where they are divided by research question.</p>
<section id="sec-baseline" class="level2">
<h2 class="anchored" data-anchor-id="sec-baseline">Baseline scenario</h2>
<p>The baseline scenario was defined as the set of methods currently being used by members of different teams at Satelligence to find, retrieve and visualize spatial data. This baseline scenario was evaluated qualitatively by interviewing four members of two different teams in the company (i.e.&nbsp;the data and the operations team). To keep a balance regarding experience of the study subjects, both the newest member of each team and a member with at least three years in the company were interviewed.</p>
<p>The questions asked during the interviews were oriented towards two main topics that were covered during this internship: Spatial data discovery and spatial data visualization. For both topics, the questions were divided into questions related to raster and vector datasets. The questions included in the interview can be found in <a href="#sec-baseline-q" class="quarto-xref">Section&nbsp;5.1</a> and were meant to be open questions with multiple possible answers.</p>
<p>Furthermore, based on the answers of the interviewees a flowchart was built to represent visually the traditional steps performed to discover and visualize S11 data. This visual representation included estimations of the steps where more time was spent on.</p>
<p>Finally, the answers to the questionnaire were analyzed qualitatively following a Thematic Content Analysis (TCA). This type of qualitative analysis focuses on finding common themes in the interviews undertaken <span class="citation" data-cites="anderson_thematic_2007">(<a href="#ref-anderson_thematic_2007" role="doc-biblioref">Anderson, 2007</a>)</span>. The extraction of common patterns within the interviews was initially done using a large language model (i.e.&nbsp;Chat-GPT 3.5 <span class="citation" data-cites="openai_chatgpt_2023">(<a href="#ref-openai_chatgpt_2023" role="doc-biblioref">OpenAI, 2023</a>)</span>) using the prompt presented on <a href="#sec-gpt-prompt" class="quarto-xref">Section&nbsp;5.2</a>. Moreover, the themes identified were further refined based on the interviewer’s interpretation.</p>
</section>
<section id="data-and-service-integration" class="level2">
<h2 class="anchored" data-anchor-id="data-and-service-integration">Data and service integration</h2>
<p>To efficiently integrate tools for big geo-spatial data discovery and visualization, a series of steps had to be followed. Initially, the datasets were selected. Subsequently, the structure of the catalog was defined. Following this, a Git repository containing the code required to generate the catalog was created. Static JSON files were then utilized to construct a dynamic STAC API. Ultimately, this API was deployed alongside other services using a continuous integration (CI) and continuous deployment (CD) pipeline. A further explanation of each step is presented in the following subsections.</p>
<section id="dataset-selection" class="level3">
<h3 class="anchored" data-anchor-id="dataset-selection">Dataset selection</h3>
<p>Due to the desire of the company to continue moving towards a cloud-based workflow. The datasets that were considered for the catalog, were composed of either COGs or Zarrs. Nevertheless, since some of the data in the company is stored as virtual rasters (VRTs), methods to also index this type of data formats in the STAC catalog were included. Specifically, S11’s long term goal is to store in the catalog datasets that can be classified as follows:</p>
<ul>
<li>Static raster data
<ul>
<li>Forest baselines (Stored as COGs)</li>
<li>Third-party data (Stored as VRTs, Tiffs, or other formats)</li>
</ul></li>
<li>DPROF results
<ul>
<li>Results of continuous deforestation monitoring (Stored as ZARRs)</li>
<li>Other DPROF results</li>
</ul></li>
<li>Supply chain data (Vector data)</li>
<li>Complaince data (Vector data)</li>
</ul>
<p>Nevertheless, the scope of this internship was limited to raster datasets. Therefore, the creation of the catalog was done using a limited amount of raster layers and they were incorporated as a proof of concept of how the catalog could be created.</p>
</section>
<section id="proposed-catalog-structure" class="level3">
<h3 class="anchored" data-anchor-id="proposed-catalog-structure">Proposed Catalog structure</h3>
<p>The structure of the STAC catalog proposed can be seen on <a href="#fig-stac-str" class="quarto-xref">Figure&nbsp;1</a>. In it, a selection of datasets that should be referenced in the catalog is presented and a hierarchical structure composed of thematic collections is suggested. This structure was not followed in the creation of the proof-of-concept catalog, as the purpose of this catalog was only to demonstrate the process of creating it. The final version of the structure will be determined by the company.</p>
<div id="fig-stac-str" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stac-str-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/STAC_Satelligence_structure.png" class="img-fluid figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stac-str-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Proposed STAC structure
</figcaption>
</figure>
</div>
</section>
<section id="s11-cats-repository" class="level3">
<h3 class="anchored" data-anchor-id="s11-cats-repository">S11-cats repository</h3>
<p>The <a href="https://gitlab.com/satelligence/s11-cats">s11-cats repository</a> created is composed of a module named <code>cats</code> which consists of five submodules described in <a href="#tbl-cats-modules" class="quarto-xref">Table&nbsp;2</a>. Moreover, an overview of the main workflow followed in the main function of s11-cats is presented on <a href="#fig-s11-cats" class="quarto-xref">Figure&nbsp;2</a>.</p>
<div id="tbl-cats-modules" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-cats-modules-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Description of cats submodules
</figcaption>
<div aria-describedby="tbl-cats-modules-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 47%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Submodule</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>gcs_tools</em></td>
<td>Module with functions to interact with data stored at Google Cloud Storage</td>
</tr>
<tr class="even">
<td><em>general_metadata</em></td>
<td>Module to extract general metadata for a STAC item.</td>
</tr>
<tr class="odd">
<td><em>get_spatial_info</em></td>
<td>Module to get all spatial information from assets.</td>
</tr>
<tr class="even">
<td><em>get_temporal_info</em></td>
<td>Module with functions to extract temporal metadata of a dataset.</td>
</tr>
<tr class="odd">
<td><em>stac_tools</em></td>
<td>Module with the functions to initialize a STAC, add collections, items and assets to it.</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="fig-s11-cats" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-s11-cats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/s11-cats.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-s11-cats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: S11- cats main function
</figcaption>
</figure>
</div>
<p>As observed, the code in the repository requires a dictionary containing collection titles, descriptions, and tags, along with a list of links for each item to be added to each collection. It then generates two JSON files: one storing the collections’ information and the other storing the items’ information. This decision to produce two JSON files was made to facilitate the transition from the static catalog that has been created to the dynamic catalog that is desired.</p>
</section>
<section id="sec-eoapi" class="level3">
<h3 class="anchored" data-anchor-id="sec-eoapi">eoAPI + other services</h3>
<p>Once a static catalog has been created, the next step involves developing the dynamic catalog by leveraging <a href="https://eoapi.dev/">eoAPI</a> <span class="citation" data-cites="sarago_developmentseedeoapi_2024">(<a href="#ref-sarago_developmentseedeoapi_2024" role="doc-biblioref">Sarago et al., 2024</a>)</span>. <a href="https://eoapi.dev/">eoAPI</a> is a robust tool designed for managing, discovering and visualizing Earth observation data. It integrates several services that include indexing of large STAC collections and items using a Postgres database (See <a href="https://github.com/stac-utils/pgstac">PgSTAC</a>), creating a dynamic catalog that can query the Postgres database (See <a href="https://github.com/stac-utils/stac-fastapi">STAC API</a>) and two additional services for visualizing raster (See <a href="https://github.com/stac-utils/titiler-pgstac">Titiler-PgSTAC</a>) and vector data (See <a href="https://github.com/developmentseed/tipg">TiPg</a>).</p>
<p><a href="https://eoapi.dev/">eoAPI</a> integrates all of these services by using containerized versions that are able to communicate seamlessly with each other. A container is a lightweight, standalone, and executable package of software that includes everything needed to run an application. Containerizing the services facilitates deployment to the cloud using Google Kubernetes Engine (GKE). Kubernetes is an open-source platform designed for automating the deployment, scaling, and management of containerized applications <span class="citation" data-cites="poulton_kubernetes_2023">(<a href="#ref-poulton_kubernetes_2023" role="doc-biblioref">Poulton, 2023</a>)</span>. It offers various advantages, such as scalability, efficient resource utilization, and simplified maintenance, making it an ideal solution for managing the dynamic catalog and the integrated services in a cloud environment.</p>
<p>Since the current version of <a href="https://eoapi.dev/">eoAPI</a> does not include some extra services that were necessary to deploy, a separate containerized version of these services was deployed in the same K8 cluster. Notably, a version of <a href="https://github.com/radiantearth/stac-browser">STAC Browser</a> and <a href="https://github.com/developmentseed/titiler-xarray">TiTiler-Xarray</a> to browse the catalog created and visualize Zarr datasets respectively.</p>
</section>
<section id="cicd-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="cicd-pipeline">CI/CD pipeline</h3>
<p>Finally, a gitlab CI/CD pipeline was created to automate the creation of the catalog using the <a href="https://gitlab.com/satelligence/s11-cats">s11-cats repository</a>, the deployment of eoAPI and extra services and the ingestion of the catalog into the deployed version of the dynamic catalog.</p>
</section>
<section id="comparison-with-baseline-scenario" class="level3">
<h3 class="anchored" data-anchor-id="comparison-with-baseline-scenario">Comparison with baseline scenario</h3>
<p>Once a version of all of the services integrated was deployed online, the ease of discovery and visualization was again qualitatively analyzed by evaluating the steps processed for both finding and visualizing S11 data. These steps were then represented in a flowchart that could be compared to the one created on <a href="#sec-baseline" class="quarto-xref">Section&nbsp;2.1</a>.</p>
</section>
</section>
<section id="multi-format-data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="multi-format-data-visualization">Multi-format data visualization</h2>
<p>To assess the performance of dynamic tiling services for visualizing Cloud Optimized GeoTIFFs (COGs) and Zarr data formats, the following approach was undertaken. Firstly, a COG containing forest baseline information for the Riau region of Indonesia was used to create a series of Zarr files, each representing different overviews corresponding to various zoom levels. This pre-processing step, completed by the company prior to the study, ensured that the same data was used across both data formats, allowing for direct comparison. Then, the <a href="https://github.com/developmentseed/titiler-xarray">TiTiler-Xarray</a> service was then customized to work with the specific folder structure of the ZARR overviews previously created. Moreover, containerized versions of both <a href="https://github.com/developmentseed/titiler-xarray">TiTiler-Xarray</a> (for Zarr files) and <a href="https://github.com/stac-utils/titiler-pgstac">TiTiler-PgSTAC</a> (for COG files) were deployed. The performance was measured by recording the response times for random tile requests at zoom levels ranging from 9 to 18. Finally, to mitigate the influence of cached data on response times, each iteration used a different colormap, with a total of twelve colormaps employed. This methodology enabled a systematic evaluation of the performance differences between the two data formats in a geo-spatial data visualization context.</p>
<section id="speed-up" class="level3">
<h3 class="anchored" data-anchor-id="speed-up">Speed up</h3>
<p>The performance of both TiTiler services to dynamically create tiles for the different data formats was evaluated using the Speed Up metric proposed in <span class="citation" data-cites="durbha_advances_2023">Durbha et al. (<a href="#ref-durbha_advances_2023" role="doc-biblioref">2023</a>)</span> (<a href="#eq-speed-up" class="quarto-xref">Equation&nbsp;1</a>). In this case, the Speed Up explains how much did the process of requesting tiles sped up by using a data format A compared to using a data format B.</p>
<p><span id="eq-speed-up"><span class="math display">\[ SpeedUp = \frac{t_{format A}}{t_{format B}}  \tag{1}\]</span></span></p>
</section>
<section id="zoom-level-influence" class="level3">
<h3 class="anchored" data-anchor-id="zoom-level-influence">Zoom level influence</h3>
<p>Finally, the effect of the level of zoom in a web map visualization on the response times of requesting tiles from the different tiling services was evaluated by fitting an Ordinary Least Squares (OLS) univariate linear regression that followed <a href="#eq-lin-reg" class="quarto-xref">Equation&nbsp;2</a>.</p>
<p><span id="eq-lin-reg"><span class="math display">\[ ResponseTime = \beta_1 \cdot ZoomLevel + \beta_0 + \epsilon  \tag{2}\]</span></span></p>
</section>
</section>
</section>
<section id="results-discussion" class="level1">
<h1>Results &amp; Discussion</h1>
<section id="baseline-scenario" class="level2">
<h2 class="anchored" data-anchor-id="baseline-scenario">Baseline scenario</h2>
<section id="current-workflow" class="level3">
<h3 class="anchored" data-anchor-id="current-workflow">Current workflow</h3>
<p>One of the main findings of the interviews was the process followed currently to discover, retrieve and visualize data. These steps are summarized on <a href="#fig-baseline" class="quarto-xref">Figure&nbsp;3</a> and show how complex and time consuming these tasks can be for a Satelligence employee nowadays. Moreover, the steps followed were categorized in four classes depending on how much time is generally spent carrying it out.</p>
<div id="fig-baseline" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-baseline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/Baseline_data_discovery_workflow.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-baseline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Baseline workflow
</figcaption>
</figure>
</div>
<p>According to <a href="#fig-baseline" class="quarto-xref">Figure&nbsp;3</a>, some of the most time-consuming tasks were searching for data on Google Cloud Storage and downloading it for visualization. Additionally, seeking advice from colleagues about the dataset’s location added significant uncertainty to the time estimates, as responses varied from very quick to considerably delayed or non existent.</p>
</section>
<section id="thematic-content-analysis" class="level3">
<h3 class="anchored" data-anchor-id="thematic-content-analysis">Thematic Content Analysis</h3>
<p>When asked about the recurrent patterns on the interviews undertaken to define the baseline scenario, ChatGPT found four main topics:</p>
<ul>
<li>There is a high uncertainty on the location of datasets and a high dependency on colleagues to find them.</li>
<li>Multiple sources and locations of data.</li>
<li>Data familiarity helps users locate data quicker.</li>
<li>Use of specific tools and methods for different datasets.</li>
</ul>
<p>After some refinement and a deeper analysis of the interviews, the major pitfalls found on the process of data discovery and visualization in the company were summarized as follows:</p>
<ul>
<li>High dependency on colleagues for dataset location.</li>
<li>Disorganized structure of Google Storage Buckets.</li>
<li>Data familiarity helps users locate data quicker.</li>
<li>Data location is dependent on recurrent work with a specific dataset.</li>
<li>Not intuitive naming of repositories with datasets.</li>
<li>Understanding of diverse tools to access different data is currently necessary.</li>
<li>Download of data is required in most cases to visualize it.</li>
<li>Not one place where all existing data can be found.</li>
</ul>
<p>All of these pitfalls highlight the need for a simpler data discovery implementation, where data visualization can also be integrated seamlessly. This approach should allow for easy access to datasets based on specific queries.</p>
<p>All of these pitfalls highlight the need for a simpler data discovery implementation, where data visualization can also be integrated seamlessly. Previous studies have found that key difficulties for earth observation data discovery include heterogeneous query interfaces, and use of diverse metadata models <span class="citation" data-cites="miranda_espinosa_reviewing_2020">(<a href="#ref-miranda_espinosa_reviewing_2020" role="doc-biblioref">Miranda Espinosa et al., 2020</a>)</span>. Addressing these challenges, a streamlined approach should enable easy access to datasets based on specific queries, ensuring that users can efficiently locate and utilize the data they need. By harmonizing metadata standards and query protocols, the process of data discovery can be greatly improved, making it more accessible and user-friendly.</p>
</section>
</section>
<section id="service-integration" class="level2">
<h2 class="anchored" data-anchor-id="service-integration">Service integration</h2>
<p>The integration of the services deployed resulted in a version of STAC Browser including three different collections containing datasets related to the forest baseline created by the company, elevation data from third party organizations and a collection for the comparison of COG and Zarr data. The web application can be accessed in <a href="https://eoapi.satelligence.com/browser/?.language=en">https://eoapi.satelligence.com/browser</a>.</p>
<section id="effective-integration" class="level3">
<h3 class="anchored" data-anchor-id="effective-integration">Effective integration</h3>
<p>The effective integration was not an easy task and involved multiple aspects, ranging from editing data formats to facilitate their visualization, transitioning from a static to a dynamic catalog, customizing APIs, and finalizing with the correct deployment of the services.</p>
<section id="data-formats" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="data-formats">Data formats</h4>
<p>An essential step related to data formats was the edition of Zarr datasets to achieve their optimal visualization. This edition involved creating a series of overviews of the same dataset at different resolutions. Specifically, this was accomplished by converting Cloud Optimized GeoTIFFs (COGs) into multiple Zarr files resampled at various spatial resolutions. These resampled Zarr files, acting as overviews enhance visualization by allowing the appropriate resolution to be accessed based on the map scale, similar to the approach used when visualizing COGs <span class="citation" data-cites="lynnes_cloud_2020">(<a href="#ref-lynnes_cloud_2020" role="doc-biblioref">Lynnes et al., 2020</a>)</span>. Even though the approach followed in this study allowed for improved visualization of Zarr files, the creation of Zarr pyramids in a more optimized way is still necessary. Other researchers have been focusing their efforts on this task to enhance the efficiency and effectiveness of the process <span class="citation" data-cites="Barciauskas_NextGen_2024">(<a href="#ref-Barciauskas_NextGen_2024" role="doc-biblioref">Barciauskas et al., 2024</a>)</span>.</p>
</section>
<section id="leverage-of-apis" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="leverage-of-apis">Leverage of APIs</h4>
<p>To effectively query the datasets stored in the catalog, a transition from a static to a dynamic catalog (i.e.&nbsp;a STAC API) was needed. This shift was facilitated by the deployment of a STAC API within the eoAPI framework. The STAC API possibilitated the querying capabilities of the datasets stored in the catalog by dynamically requesting datasets based on their metadata. This dynamic setup not only facilitated data discovery but also enabled the use of additional tools such as the STAC API QGIS plugin. The plugin could simplify the process of data discovery and its direct manipulation.</p>
<p>For the visualization of Zarr datasets, it was necessary to customize the TiTiler-Xarray API to accommodate the new Zarr pyramid structure. This customization involved overwriting a series of functions in the main code of the application to align with the newly created Zarr pyramids. By adapting the API to handle the specific requirements of the Zarr format and its multi-resolution overviews, the visualization process was optimized.</p>
</section>
<section id="deployment" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="deployment">Deployment</h4>
<p>As described on <a href="#sec-eoapi" class="quarto-xref">Section&nbsp;2.2.4</a>, the deployment of both eoAPI and the additional services utilized was perform using Google Kubernetes Engine (GKE), which is K8s’ GCP service. In a GKE cluster, the setup of complex multi-service applications that connect to each other with an internal network is simplified <span class="citation" data-cites="gupta_deployment_2021">(<a href="#ref-gupta_deployment_2021" role="doc-biblioref">Gupta et al., 2021</a>)</span>. Moreover, <a href="www.eoapi.dev">eoAPI</a> simplified the deployment by providing a guide for deployment that used a Helm chart. A Helm chart is a collection of files that describe the K8s related resources needed to run a multi-service application and it can improve the speed of deployment by a factor of up to 6 times <span class="citation" data-cites="gokhale_creating_2021">(<a href="#ref-gokhale_creating_2021" role="doc-biblioref">Gokhale et al., 2021</a>)</span>. These factors greatly influenced the decision of deploying the whole suite of services in eoAPI.</p>
<p>Moreover, the performance of some of the eoAPI services deployed using K8s had been already assessed by previous studies. …</p>
<p>Additional to the simplification that eoAPI provided to deploy this using GKE and the Helm chart, we also went for that option because it had already been tested by other authors using large datasets and heavy load requests <span class="citation" data-cites="munteanu_performance_2024">(<a href="#ref-munteanu_performance_2024" role="doc-biblioref">Munteanu et al., 2024</a>)</span>. <span class="citation" data-cites="munteanu_performance_2024">Munteanu et al. (<a href="#ref-munteanu_performance_2024" role="doc-biblioref">2024</a>)</span> perform tests with 2.3 TB of spatial data stored in S3 and a simulated simultaneous load of up to 7k users and their results showed good performance serving the data. (REVIEW)</p>
<p>Also the fact that it integrates other services that we are not using, but would come very handy in the near future for satelligence.</p>
<p>Compare with other ways in which this could have been done? Virtual Machine (Compute Engine)</p>
<p>discussion: - Vector visualization can be done in the future. - Authentication - stac extensions.</p>
</section>
</section>
<section id="workflow-improvement" class="level3">
<h3 class="anchored" data-anchor-id="workflow-improvement">Workflow improvement</h3>
<p>Once the deployment of eoAPI and the extra services was done, a new workflow for both the new data discovery and visualization tasks was designed and is presented on <a href="#fig-new-workflow" class="quarto-xref">Figure&nbsp;4</a>. This new workflow shows a clear improvement on the speed and the ease of use of the new methods employed.</p>
<div id="fig-new-workflow" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-new-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/New_data_discovery_workflow.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-new-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: New data discovery and visualization workflow
</figcaption>
</figure>
</div>
<p>Moreover, it can be seen that with the new implementation most of the issues identified on the TCA were addressed. There is no longer a dependency on colleagues for locating datasets, as all data is now consolidated in one place. The disorganized structure of Google Storage Buckets is no longer a concern since the catalog can integrate data stored in multiple buckets into a single, cohesive STAC collection. The previous issue of non-intuitive naming conventions for data repositories, is resolved because it is unnecessary to know the data source once it is included in the STAC catalog. Furthermore, there is no longer a need to understand diverse tools for accessing different data; the STAC Browser facilitates querying collections and visualizing items. Finally, the STAC catalog serves as the centralized location for all data used in S11 workflows, which favours long term usability of code that relies on this data.</p>
</section>
</section>
<section id="performance-of-multi-format-data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="performance-of-multi-format-data-visualization">Performance of multi-format data visualization</h2>
<section id="raster-formats" class="level3">
<h3 class="anchored" data-anchor-id="raster-formats">Raster formats</h3>
<p>The comparison of visualization speeds with TiTiler-xarray for Zarr datasets and TiTiler-PgSTAC for COGs are presented on <a href="#fig-format-comp" class="quarto-xref">Figure&nbsp;5</a>. In the figure it can be obesrved that COG tiles are requested 2.53 times faster than the same file in ZARR format.</p>
<div id="cell-fig-format-comp" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div id="fig-format-comp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-format-comp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="FinalReport_files/figure-html/fig-format-comp-output-1.png" width="634" height="436" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-format-comp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Request times depending on data format and zoom level
</figcaption>
</figure>
</div>
</div>
</div>
<section id="fine-tuning-of-dataset-creation" class="level4">
<h4 class="anchored" data-anchor-id="fine-tuning-of-dataset-creation">Fine tuning of dataset creation</h4>
<p>There are some GDAL parameters that can improve the tiling performance of TiTiler (See <a href="https://developmentseed.org/titiler/advanced/performance_tuning/">performnce_tuning</a>). This should be taken into account in future dataset creation</p>
<p>Also how well</p>
</section>
</section>
<section id="effects-of-zoom-level" class="level3">
<h3 class="anchored" data-anchor-id="effects-of-zoom-level">Effects of zoom level</h3>
<p>As seen on <a href="#fig-comp-zoom" class="quarto-xref">Figure&nbsp;6</a>, the zoom level of the map will have an effect on the time spent requesting and getting a tile from a tile server. In this study, it was found that the request times decreased by -0.01 and 0.002 seconds per zoom level for COGs and ZARRs respectively.</p>
<div id="cell-fig-comp-zoom" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div id="fig-comp-zoom" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comp-zoom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="FinalReport_files/figure-html/fig-comp-zoom-output-1.png" width="634" height="436" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comp-zoom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Request times depending on zoom level
</figcaption>
</figure>
</div>
</div>
</div>
<section id="discussion" class="level4">
<h4 class="anchored" data-anchor-id="discussion">Discussion</h4>
<p>Range request of tiles in titiler-xarray is customized in a particular way. Nevertheless, other alternatives exist…</p>
<p>Check on how different cloud services providers might give different latencies when opening several files instead of only one. (Niklas mentioned)</p>
</section>
</section>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-anderson_thematic_2007" class="csl-entry" role="listitem">
Anderson, R. (2007). <em>Thematic content analysis (<span>TCA</span>)</em>. <a href="https://rosemarieanderson.com/wp-content/uploads/2014/08/ThematicContentAnalysis.pdf">https://rosemarieanderson.com/wp-content/uploads/2014/08/ThematicContentAnalysis.pdf</a>
</div>
<div id="ref-Barciauskas_NextGen_2024" class="csl-entry" role="listitem">
Barciauskas, A., Jones, M., Martin, K., Harkins, S. and Sarago, V. (2024). <span>Next-Gen Zarr Web Map Visualization</span>. <em>EGU General Assembly Conference Abstracts</em>, 11805. p. <a href="https://doi.org/10.5194/egusphere-egu24-11805">https://doi.org/10.5194/egusphere-egu24-11805</a>
</div>
<div id="ref-brodeur_geographic_2019" class="csl-entry" role="listitem">
Brodeur, J., Coetzee, S., Danko, D., Garcia, S. and Hjelmager, J. (2019). Geographic information metadata—an outlook from the international standardization perspective. <em><span>ISPRS</span> International Journal of Geo-Information</em>, <em>8</em>(6), 280. p. <a href="https://doi.org/10.3390/ijgi8060280">https://doi.org/10.3390/ijgi8060280</a>
</div>
<div id="ref-chester_ogc_2024" class="csl-entry" role="listitem">
Chester, S. (2024(e)ko Januaryk 18). <em><span>OGC</span> forms new <span>GeoZarr</span> standards working group to establish a zarr encoding for geospatial data. Open geospatial consortium</em>. <a href="https://www.ogc.org/press-release/ogc-forms-new-geozarr-standards-working-group-to-establish-a-zarr-encoding-for-geospatial-data/">https://www.ogc.org/press-release/ogc-forms-new-geozarr-standards-working-group-to-establish-a-zarr-encoding-for-geospatial-data/</a>
</div>
<div id="ref-clark_api_2020" class="csl-entry" role="listitem">
Clark, J. (2020). <em>Application programming interface</em>. <a href="https://www.semanticscholar.org/paper/Application-Programming-Interface-Clark/84f0b513a62a4f2bb09a899a128a231eccace22c">https://www.semanticscholar.org/paper/Application-Programming-Interface-Clark/84f0b513a62a4f2bb09a899a128a231eccace22c</a>
</div>
<div id="ref-desruisseaux_ogc_2021" class="csl-entry" role="listitem">
Desruisseaux, M., Giacco, G., Goncalves, P., Manente, M. and Rouault, E. (2021). <em><span>OGC</span> testbed 17: <span>COG</span>/zarr evaluation engineering report</em>. <a href="https://docs.ogc.org/per/21-032.html#toc11">https://docs.ogc.org/per/21-032.html#toc11</a>
</div>
<div id="ref-durbha_advances_2023" class="csl-entry" role="listitem">
Durbha, S. S., Sanyal, J., Yang, L., S Chaudhari, S., Bhangale, U., Bharambe, U. and Kurte, K. (2023). <em>Advances in scalable and intelligent geospatial analytics: Challenges and applications</em> (1st ed.). <span>CRC</span> Press. <a href="https://doi.org/10.1201/9781003270928">https://doi.org/10.1201/9781003270928</a>
</div>
<div id="ref-giri_big_2014" class="csl-entry" role="listitem">
Giri, K. and Lone, T. (2014). Big data -overview and challenges. <em>International Journal of Advanced Research in Computer Science and Software Engineering</em>, <em>4</em>.
</div>
<div id="ref-gokhale_creating_2021" class="csl-entry" role="listitem">
Gokhale, S., Poosarla, R., Tikar, S., Gunjawate, S., Hajare, A., Deshpande, S., Gupta, S. and Karve, K. (2021). Creating helm charts to ease deployment of enterprise application and its related services in kubernetes. <em>2021 International Conference on Computing, Communication and Green Engineering (<span>CCGE</span>)</em>, 1–5. pp. <a href="https://doi.org/10.1109/CCGE50943.2021.9776450">https://doi.org/10.1109/CCGE50943.2021.9776450</a>
</div>
<div id="ref-gupta_deployment_2021" class="csl-entry" role="listitem">
Gupta, M., Sanjana, K., Akhilesh, K. and Chowdary, M. N. (2021). Deployment of multi-tier application on cloud and continuous monitoring using kubernetes. <em>2021 5th International Conference on Electrical, Electronics, Communication, Computer Technologies and Optimization Techniques (<span>ICEECCOT</span>)</em>, 602–607. pp. <a href="https://doi.org/10.1109/ICEECCOT52851.2021.9707957">https://doi.org/10.1109/ICEECCOT52851.2021.9707957</a>
</div>
<div id="ref-holmes_spatiotemporal_2021" class="csl-entry" role="listitem">
Holmes, C. (2021(e)ko Januaryk 19). <em><span>SpatioTemporal</span> asset catalogs and the open geospatial consortium. Radiant earth insights</em>. <a href="https://medium.com/radiant-earth-insights/spatiotemporal-asset-catalogs-and-the-open-geospatial-consortium-659538dce5c7">https://medium.com/radiant-earth-insights/spatiotemporal-asset-catalogs-and-the-open-geospatial-consortium-659538dce5c7</a>
</div>
<div id="ref-kaufmann_database_2023" class="csl-entry" role="listitem">
Kaufmann, M. and Meier, A. (2023). Database management. In M. Kaufmann and A. Meier (Eds.), <em><span>SQL</span> and <span>NoSQL</span> databases: Modeling, languages, security and architectures for big data management</em> (1–24. pp.). Springer Nature Switzerland. <a href="https://doi.org/10.1007/978-3-031-27908-9_1">https://doi.org/10.1007/978-3-031-27908-9_1</a>
</div>
<div id="ref-lynnes_cloud_2020" class="csl-entry" role="listitem">
Lynnes, C., Quinn, P., Durbin, C. and Shum, D. (2020). <em>Cloud optimized data formats</em>.
</div>
<div id="ref-miranda_espinosa_reviewing_2020" class="csl-entry" role="listitem">
Miranda Espinosa, M. T., Giuliani, G. and Ray, N. (2020). Reviewing the discoverability and accessibility to data and information products linked to essential climate variables. <em>International Journal of Digital Earth</em>, <em>13</em>(2), 236–252. pp. <a href="https://doi.org/10.1080/17538947.2019.1620882">https://doi.org/10.1080/17538947.2019.1620882</a>
</div>
<div id="ref-mishra_structured_2017" class="csl-entry" role="listitem">
Mishra, S. and Misra, A. (2017). Structured and unstructured big data analytics. <em>2017 International Conference on Current Trends in Computer, Electrical, Electronics and Communication (<span>CTCEEC</span>)</em>, 740–746. pp. <a href="https://doi.org/10.1109/CTCEEC.2017.8454999">https://doi.org/10.1109/CTCEEC.2017.8454999</a>
</div>
<div id="ref-munteanu_performance_2024" class="csl-entry" role="listitem">
Munteanu, A., Panica, S. and Iuhasz, G. (2024). On the performance of <span>STAC</span>-<span>FastAPI</span> and <span>PgSTAC</span> using a cloud-native deployment. In L. Barolli (Ed.), <em>Advanced information networking and applications</em> (191–200. pp.). Springer Nature Switzerland. <a href="https://doi.org/10.1007/978-3-031-57931-8_19">https://doi.org/10.1007/978-3-031-57931-8_19</a>
</div>
<div id="ref-ogc_ogc_2023" class="csl-entry" role="listitem">
OGC. (2023). <em><span>OGC</span> cloud optimized <span>GeoTIFF</span> standard</em>. <a href="https://docs.ogc.org/is/21-026/21-026.html">https://docs.ogc.org/is/21-026/21-026.html</a>
</div>
<div id="ref-openai_chatgpt_2023" class="csl-entry" role="listitem">
OpenAI. (2023). <em><span>ChatGPT</span></em>. <a href="https://chatgpt.com/">https://chatgpt.com/</a>
</div>
<div id="ref-poulton_kubernetes_2023" class="csl-entry" role="listitem">
Poulton, N. (2023). <em>The kubernetes book</em>. Nigel Poulton Ltd.
</div>
<div id="ref-noauthor_stac-specbest-practicesmd_nodate" class="csl-entry" role="listitem">
RadiantEarth. (2024). <em>Stac-spec/best-practices.md at master · radiantearth/stac-spec. <span>GitHub</span></em>. <a href="https://github.com/radiantearth/stac-spec/blob/master/best-practices.md">https://github.com/radiantearth/stac-spec/blob/master/best-practices.md</a>
</div>
<div id="ref-rajabifard_spatial_2001" class="csl-entry" role="listitem">
Rajabifard, A. and Williamson, I. P. (2001). <em>Spatial data infrastructures: Concept, <span>SDI</span> hierarchy and future directions</em>. <a href="http://hdl.handle.net/11343/33897">http://hdl.handle.net/11343/33897</a>
</div>
<div id="ref-sarago_developmentseedeoapi_2024" class="csl-entry" role="listitem">
Sarago, V., Deziel, Z., Tenezakis, E. and Goodman, L. (2024). <em>Developmentseed/<span class="nocase">eoAPI</span></em> [Software]. Development Seed. <a href="https://github.com/developmentseed/eoAPI">https://github.com/developmentseed/eoAPI</a>
</div>
<div id="ref-satelligence_home_nodate" class="csl-entry" role="listitem">
Satelligence. (n.d.). <em>Home - satelligence - sustainability monitoring simplified. Satelligence</em>. Retrieved February 5, 2024, from <a href="https://satelligence.com/">https://satelligence.com/</a>
</div>
<div id="ref-satelligence_internship_2023" class="csl-entry" role="listitem">
Satelligence. (2023). <em>Internship: Cataloguing and visualizing big geodata</em>.
</div>
<div id="ref-noauthor_titiler_nodate" class="csl-entry" role="listitem">
<em><span>TiTiler</span></em>. (n.d.). Retrieved February 19, 2024, from <a href="https://developmentseed.org/titiler/">https://developmentseed.org/titiler/</a>
</div>
<div id="ref-tripathi_cloud_2020" class="csl-entry" role="listitem">
Tripathi, A. K., Agrawal, S. and Gupta, R. D. (2020). Cloud enabled <span>SDI</span> architecture: A review. <em>Earth Science Informatics</em>, <em>13</em>(2), 211–231. pp. <a href="https://doi.org/10.1007/s12145-020-00446-9">https://doi.org/10.1007/s12145-020-00446-9</a>
</div>
<div id="ref-zhao_scalable_2021" class="csl-entry" role="listitem">
Zhao, Y., Yang, X. and Vatsavai, R. R. (2021). A scalable system for searching large-scale multi-sensor remote sensing image collections. <em>2021 <span>IEEE</span> International Conference on Big Data (Big Data)</em>, 3780–3783. pp. <a href="https://doi.org/10.1109/BigData52589.2021.9671679">https://doi.org/10.1109/BigData52589.2021.9671679</a>
</div>
</div>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="sec-baseline-q" class="level2">
<h2 class="anchored" data-anchor-id="sec-baseline-q">Baseline scenario questionnaire</h2>
<section id="related-to-data-discovery" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="related-to-data-discovery">Related to data discovery</h3>
<ul>
<li>I am working for Wilmar in South East Asia. Do you know what is the forest baseline that I should use and where can I find it?</li>
<li>I have been checking the results of the Soy map we created. Do you know which DEM was used for it? And where can I find it?</li>
<li>Do you know which DEM is used as the terrain mask when using Sentinel 1 data?</li>
<li>I need to access the concessions data provided by Grepalma. Where can I find it?</li>
</ul>
</section>
<section id="related-to-data-visualization" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="related-to-data-visualization">Related to data visualization</h3>
<ul>
<li>I am interested on getting an overview of where was the primary forest present in Colombia in 2007. Could you visualize a layer with this data for me?</li>
<li>I need to visualize the concessions provided by fedepalma. Could you do it for me?</li>
</ul>
</section>
</section>
<section id="sec-gpt-prompt" class="level2">
<h2 class="anchored" data-anchor-id="sec-gpt-prompt">Thematic Content Analysis prompt</h2>
<pre><code>I will give you some notes I took from an interview I did to four study subjects:
W, X, Y and Z.

Tell me if you identify any themes or topics that are repeated in the notes that 
I took from the answers of the individuals. In other words, do a simple Thematic
Content Analysis of the interviews.</code></pre>
</section>
<section id="sec-request-code" class="level2">
<h2 class="anchored" data-anchor-id="sec-request-code">Code to evaluate request times</h2>
<p><strong>Disclaimer:</strong> In order to run the code presented below, the user must have authenticated their Google account and have the TiTiler-PgSTAC and the TiTiler-Xarray services running on <code>localhost:8082</code> and <code>localhost:8084</code> respectively.</p>
<div id="fa391a88" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tiles <span class="op">=</span> [<span class="st">"9/399/254"</span>, <span class="st">"10/800/505"</span>, <span class="st">"11/1603/1012"</span>,  <span class="st">"12/3209/2042"</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">"13/6407/4075"</span>, <span class="st">"14/12817/8159"</span>, <span class="st">"15/25678/16271"</span>, <span class="st">"16/51268/32552"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">"17/102503/65134"</span>, <span class="st">"18/205062/130211"</span>]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Tiles are slightly modified to try to avoid getting cached tiles</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> modify_tile(tile):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    parts <span class="op">=</span> tile.split(<span class="st">'/'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> <span class="bu">int</span>(parts[<span class="dv">0</span>])</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">int</span>(parts[<span class="dv">1</span>])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="bu">int</span>(parts[<span class="dv">2</span>])</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine the range of change based on the value of z</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> z <span class="op">&lt;=</span> <span class="dv">9</span>:</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        change_range <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> z <span class="op">&lt;=</span> <span class="dv">12</span>:</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        change_range <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> z <span class="op">&lt;=</span> <span class="dv">15</span>:</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        change_range <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> z <span class="op">&lt;=</span> <span class="dv">18</span>:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        change_range <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply the change to x and y</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    x_change <span class="op">=</span> random.randint(<span class="op">-</span>change_range, change_range)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    y_change <span class="op">=</span> random.randint(<span class="op">-</span>change_range, change_range)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    new_x <span class="op">=</span> x <span class="op">+</span> x_change</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    new_y <span class="op">=</span> y <span class="op">+</span> y_change</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the modified tile as a string</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>z<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>new_x<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>new_y<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>times_zarr <span class="op">=</span> []</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>times_cog <span class="op">=</span> []</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>z_level <span class="op">=</span> []</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>cmap_picked <span class="op">=</span> []</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co"># The colormaps picked can be either a customized one for S11</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Forest baseline or greens_r</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> [<span class="st">"_name=greens&amp;rescale=0,70"</span>,<span class="st">"_name=greens_r&amp;rescale=0,70"</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"_name=blues&amp;rescale=0,90"</span>, <span class="st">"_name=blues_r&amp;rescale=0,90"</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"_name=reds&amp;rescale=0,80"</span>, <span class="st">"_name=reds_r&amp;rescale=0,80"</span>,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"_name=gray&amp;rescale=0,70"</span>,<span class="st">"_name=gray_r&amp;rescale=0,70"</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"_name=jet&amp;rescale=0,90"</span>, <span class="st">"_name=jet_r&amp;rescale=0,90"</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"_name=hot&amp;rescale=0,80"</span>, <span class="st">"_name=hot_r&amp;rescale=0,80"</span>]</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cmap)):</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    mod_tiles <span class="op">=</span> [modify_tile(tile) <span class="cf">for</span> tile <span class="kw">in</span> tiles]</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> i</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tile <span class="kw">in</span> mod_tiles:</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        url_zarr <span class="op">=</span> <span class="st">"https://eoapi.satelligence.com/zarr/tiles/WebMercatorQuad/"</span><span class="op">+\</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>tile<span class="sc">}</span><span class="ss">%401x?url=gs://s11-tiles/zarr/separate&amp;"</span><span class="op">+\</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">"variable=band_data&amp;reference=false&amp;decode_times=true&amp;"</span><span class="op">+\</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"consolidated=true&amp;colormap</span><span class="sc">{</span>cmap[k]<span class="sc">}</span><span class="ss">&amp;return_mask=true"</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        url_cog <span class="op">=</span> <span class="ss">f"https://eoapi.satelligence.com/raster/collections/"</span><span class="op">+\</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Example%20FBL%20Riau/items/FBL_V5_2021_Riau_cog/tiles/"</span><span class="op">+\</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"WebMercatorQuad/</span><span class="sc">{</span>tile<span class="sc">}</span><span class="ss">%401x?bidx=1&amp;assets=data&amp;"</span><span class="op">+\</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">"unscale=false&amp;resampling=nearest&amp;reproject=nearest&amp;"</span><span class="op">+\</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"colormap</span><span class="sc">{</span>cmap[k]<span class="sc">}</span><span class="ss">&amp;return_mask=true"</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> requests.get(url_zarr)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        times_zarr.append(x.elapsed.total_seconds())</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> requests.get(url_cog)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        times_cog.append(x.elapsed.total_seconds())</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        z_level.append(<span class="bu">int</span>(tile.split(<span class="st">'/'</span>)[<span class="dv">0</span>]))</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        cmap_picked.append(k)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame([cmap_picked, z_level, times_cog, times_zarr]).T</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> [<span class="st">'colormap'</span>,<span class="st">'zoom level'</span>,<span class="st">'COG'</span>, <span class="st">'ZARR'</span>]</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>data.to_csv(<span class="st">'request_time_results_6iter_k8.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>